import 'package:flutter_test/flutter_test.dart';
import 'package:http/http.dart' as http;
import 'package:image_search/data/pixabay_api.dart';
import 'package:mockito/annotations.dart';
import 'package:mockito/mockito.dart';

import 'pixabay_api_test.mocks.dart';

@GenerateMocks([http.Client])
void main() {
  test('Pixabay 데이터를 잘 가져와야 한다', () async {
    final api = PixabayApi();

    final client = MockClient();

    when(client.get(Uri.parse(
            '${PixabayApi.baseUrl}?key=${PixabayApi.key}&q=iphone&image_type=photo')))
        .thenAnswer((_) async => http.Response(fakeJsonBody, 200));

    final result = await api.fetch('iphone', client: client);

    expect(result.length, 20);

    // 실제 이 코드가 동작을 했는지 검증
    verify(client.get(Uri.parse(
        '${PixabayApi.baseUrl}?key=${PixabayApi.key}&q=iphone&image_type=photo')));
  });
}

String fakeJsonBody = """
{"total":8748,"totalHits":500,"hits":[{"id":2681039,"pageURL":"https://pixabay.com/photos/phone-wallpaper-watercolor-painting-2681039/","type":"photo","tags":"phone wallpaper, watercolor, painting","previewURL":"https://cdn.pixabay.com/photo/2017/08/25/18/48/watercolor-2681039_150.jpg","previewWidth":99,"previewHeight":150,"webformatURL":"https://pixabay.com/get/gd93d3b69d0ead9289c108dfb270eb4c8309b52b1421c39e11a436f2fa53f58e62961f23ca9627243e8f1948a8667cf74211e9ad5b5dc2ffe7830a6752f93baca_640.jpg","webformatWidth":424,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/g0a0cb791d8df7c3852d254a910c961c8d186b0bfe6e69a8812e4f905acad67b97222241ed349b79c8e24c61482c1934dd1484e80e63155dc4da51f20b8962ea8_1280.jpg","imageWidth":3264,"imageHeight":4928,"imageSize":5021313,"views":1319761,"downloads":1027842,"collections":1986,"likes":1276,"comments":138,"user_id":4894494,"user":"eluela31","userImageURL":"https://cdn.pixabay.com/user/2017/04/24/19-55-29-652_250x250.jpg"},{"id":1599527,"pageURL":"https://pixabay.com/photos/phone-wallpaper-mystery-island-1599527/","type":"photo","tags":"phone wallpaper, mystery, island","previewURL":"https://cdn.pixabay.com/photo/2016/08/17/01/39/mystery-1599527_150.jpg","previewWidth":116,"previewHeight":150,"webformatURL":"https://pixabay.com/get/g38537f1d126434b9f5ba3316975395bb15800716799fbe446f52d0c5937d231c8364aeccd38cdc2676fd5bdb56edd9b095e405fbaaa6a167d324ee61303d9519_640.jpg","webformatWidth":495,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/g4fda05d13aaf60fa12d4ec77def8a7d20474aeb1863360dc5d2b6df7addffe052dfd0ae8f2ab17537f4e32b4f0f5e91ac2e758e8670caa9400c324995972822c_1280.jpg","imageWidth":3022,"imageHeight":3907,"imageSize":3563541,"views":897070,"downloads":511546,"collections":1460,"likes":1416,"comments":174,"user_id":2633886,"user":"intographics","userImageURL":"https://cdn.pixabay.com/user/2019/02/11/15-00-48-80_250x250.jpg"},{"id":620817,"pageURL":"https://pixabay.com/photos/office-notes-notepad-entrepreneur-620817/","type":"photo","tags":"office, notes, notepad","previewURL":"https://cdn.pixabay.com/photo/2015/02/02/11/08/office-620817_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g9a218b7dae7bdae9b202662d9f3b49522dcaad7769e3241aec0bdfba4c3b126d0f21695129b66d50e67f7465b3fc9a3c_640.jpg","webformatWidth":640,"webformatHeight":425,"largeImageURL":"https://pixabay.com/get/g6865f5ab89c3110477ab3874a7d1c37f70c846d3b078eaf5739a3f272e880219d9202223189f8bf2035bf45bf17cc6664f86b45dc2e795731aa6ce4d7552dd6d_1280.jpg","imageWidth":4288,"imageHeight":2848,"imageSize":2800224,"views":795742,"downloads":354364,"collections":1379,"likes":1167,"comments":275,"user_id":663163,"user":"Firmbee","userImageURL":"https://cdn.pixabay.com/user/2020/11/25/09-38-28-431_250x250.png"},{"id":1914130,"pageURL":"https://pixabay.com/photos/phone-wallpaper-spices-spoons-salt-1914130/","type":"photo","tags":"phone wallpaper, spices, spoons","previewURL":"https://cdn.pixabay.com/photo/2016/12/17/18/51/spices-1914130_150.jpg","previewWidth":133,"previewHeight":150,"webformatURL":"https://pixabay.com/get/g76a64f13cd2416958590ac98e5ae370a3063a20d38ce46d2a89e637c7371b7fb8552cc4553ea940e0a556777981587ea1d6d9274a52352338e527f8723072626_640.jpg","webformatWidth":571,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/g12f35691c6a1e69ef04bca0af17ae23f233c5f765624dcce29d984c48ae8456dc6250f6a2956e2c3a6a427c7c9cfd413226c1f86a8a9f58a93fd7341b2c84187_1280.jpg","imageWidth":3581,"imageHeight":4013,"imageSize":6193655,"views":525527,"downloads":344319,"collections":1218,"likes":1272,"comments":171,"user_id":3938704,"user":"Daria-Yakovleva","userImageURL":"https://cdn.pixabay.com/user/2016/12/06/15-05-11-524_250x250.jpg"},{"id":1979674,"pageURL":"https://pixabay.com/photos/relaxing-lounging-saturday-cozy-1979674/","type":"photo","tags":"relaxing, lounging, saturday","previewURL":"https://cdn.pixabay.com/photo/2017/01/14/15/11/relaxing-1979674_150.jpg","previewWidth":150,"previewHeight":102,"webformatURL":"https://pixabay.com/get/g420df2fd5032002f8c0057281ee1de977977d381583f42be6cd776a387186353e05813b415716a29602975597895b0866fe3f54b15fa16f950b265bc26d7e5aa_640.jpg","webformatWidth":640,"webformatHeight":438,"largeImageURL":"https://pixabay.com/get/g3fa7fc3bce81ad46776acea21956206f2bdad40bf1bfabc16eb0b987a9856b92f7f71ac949fec2f662b336cf9435aa72c7b78557d7df8306ee085e2ad4a4955f_1280.jpg","imageWidth":5310,"imageHeight":3637,"imageSize":3751070,"views":452777,"downloads":262344,"collections":1058,"likes":1199,"comments":154,"user_id":334088,"user":"JillWellington","userImageURL":"https://cdn.pixabay.com/user/2018/06/27/01-23-02-27_250x250.jpg"},{"id":410324,"pageURL":"https://pixabay.com/photos/iphone-smartphone-apps-apple-inc-410324/","type":"photo","tags":"iphone, smartphone, apps","previewURL":"https://cdn.pixabay.com/photo/2014/08/05/10/30/iphone-410324_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g23e6f046107f78a7aa1bc5d8b4b0aca5f184e6df761359919271ef209b5242a94c86e58360a403c96495a044ef8ee254_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g937001b5b472e25d3605a8b7f2b6ee45fbc8bd10e688bf7c96e0b9788bf8eb8b948a12ae46b6f487e93864439a3458fc701849b7f3c322cd8d51b1eecd51ce6e_1280.jpg","imageWidth":2180,"imageHeight":1453,"imageSize":477025,"views":828788,"downloads":498376,"collections":925,"likes":835,"comments":227,"user_id":264599,"user":"JESHOOTS-com","userImageURL":"https://cdn.pixabay.com/user/2014/06/08/15-27-10-248_250x250.jpg"},{"id":1213475,"pageURL":"https://pixabay.com/photos/phone-wallpaper-heart-clouds-sky-1213475/","type":"photo","tags":"phone wallpaper, heart, clouds","previewURL":"https://cdn.pixabay.com/photo/2016/02/21/12/09/heart-1213475_150.jpg","previewWidth":100,"previewHeight":150,"webformatURL":"https://pixabay.com/get/g0a42e4ba9ed8efb64dc7753edb115d901a0a74093eebb19cccb0e79ad1971a829e404d851d22f1bd5058d693b719386448c5dd8d6a93453ba042a756e87cd0b9_640.jpg","webformatWidth":427,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/g6510aa4a14ecfbd3992c30fee327df24a7c3712f4c7e05952fe05cd5ee382faae026b4e5859b8ec36bb489ada012f0c332fd3403c8b30abc01dc5d2696b09a02_1280.jpg","imageWidth":1667,"imageHeight":2500,"imageSize":656080,"views":803201,"downloads":598542,"collections":874,"likes":874,"comments":120,"user_id":848168,"user":"oo11o","userImageURL":""},{"id":2846221,"pageURL":"https://pixabay.com/photos/business-computer-mobile-smartphone-2846221/","type":"photo","tags":"business, computer, mobile","previewURL":"https://cdn.pixabay.com/photo/2017/10/12/22/17/business-2846221_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g4323f85aadca634ad24dde353d1ab07ab87c2401af8b746aa28f041db9d5bcf34c1f2b692d8b5016ee53ab6d8b90d897b66a92689bb0f939a9f21a6046d3f8ef_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/gb85b8b6eb7abd8e060260b939ab2a382d3b8bd08d9b981fc2f58d5a00b42663ecb475f93296847b3e4a12371aca600c1cfa44f4b1469333e53e7b1f07cf2554b_1280.jpg","imageWidth":4608,"imageHeight":3072,"imageSize":2543501,"views":463538,"downloads":333203,"collections":1104,"likes":658,"comments":103,"user_id":6689062,"user":"6689062","userImageURL":""},{"id":459196,"pageURL":"https://pixabay.com/photos/macbook-laptop-google-display-459196/","type":"photo","tags":"macbook, laptop, google","previewURL":"https://cdn.pixabay.com/photo/2014/09/24/14/29/macbook-459196_150.jpg","previewWidth":150,"previewHeight":92,"webformatURL":"https://pixabay.com/get/g345cbfb89c6386cd61aa98025d2518efbd008cc8125fc295668ca267ab19d72a680a818305a6e8e457ed536abfbaf973_640.jpg","webformatWidth":640,"webformatHeight":396,"largeImageURL":"https://pixabay.com/get/gdafbe4c79b2c0d237c306563b7697b0290630281fd3b2536565bed6085beca0ca54291822b598c8937c46981b880709378f5236605761846ef1df7e445757a8f_1280.jpg","imageWidth":3888,"imageHeight":2406,"imageSize":2883743,"views":619541,"downloads":320665,"collections":818,"likes":790,"comments":224,"user_id":377053,"user":"377053","userImageURL":""},{"id":3746423,"pageURL":"https://pixabay.com/photos/ruin-castle-middle-ages-dramatic-3746423/","type":"photo","tags":"ruin, castle, middle ages","previewURL":"https://cdn.pixabay.com/photo/2018/10/14/13/01/ruin-3746423_150.jpg","previewWidth":106,"previewHeight":150,"webformatURL":"https://pixabay.com/get/g2e32df278986737079d082222d86e6b33ceef8e47a15de61045cd5b50e3ffc21dc5d3d2a6e63b9087357be40480fcd97ca1a416c846cd394a109847f86d5d874_640.jpg","webformatWidth":452,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/gf835f1877dea7589488b1e75f16ad82dc1334746bb89f9fe113e7a9c2737f95abf269bbc275bf6c859174c56343b8bdbafcd1bcf6593f5e6332376e73aeb839a_1280.jpg","imageWidth":3508,"imageHeight":4961,"imageSize":4680479,"views":355206,"downloads":298993,"collections":854,"likes":713,"comments":136,"user_id":1664300,"user":"Darkmoon_Art","userImageURL":"https://cdn.pixabay.com/user/2022/09/27/12-51-07-71_250x250.jpg"},{"id":3076954,"pageURL":"https://pixabay.com/photos/desk-smartphone-iphone-notebook-3076954/","type":"photo","tags":"desk, smartphone, iphone","previewURL":"https://cdn.pixabay.com/photo/2018/01/11/21/27/desk-3076954_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g8555278a7d4f4cf869b5eae6355011ade77b0cdb3d22b4e71b09705240c76c8f705e4d360f30f525b446d927dd810b3c260c27976b0d73874774370a862759e1_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g481692bb1b2b1677f9170d0ec66849ac4311bf1e4cbcd4c0782320ae8ac0761c915652c304e6693761f7cf9da6da5160016001f36ef62e8842f49b0c9834a21c_1280.jpg","imageWidth":5304,"imageHeight":3531,"imageSize":2258922,"views":275353,"downloads":177487,"collections":955,"likes":608,"comments":106,"user_id":2218222,"user":"Ylanite","userImageURL":"https://cdn.pixabay.com/user/2021/11/18/21-11-44-855_250x250.png"},{"id":298243,"pageURL":"https://pixabay.com/photos/smoke-abstract-background-fumes-298243/","type":"photo","tags":"smoke, abstract, background","previewURL":"https://cdn.pixabay.com/photo/2014/03/25/22/53/smoke-298243_150.jpg","previewWidth":100,"previewHeight":150,"webformatURL":"https://pixabay.com/get/g747e0788918269e595196e2ab863d9c5d661bcf2dbd9d68fa726d2f38cd63f2a46b187ab83f58fed3523edc07fb77761_640.jpg","webformatWidth":425,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/g67e153a973d1451b3527632b3bb83009b1b552b2cfa28f11709001d2ab842a30bad09cf1a55ab3ef5c30423afeaa84245f252830abaa9b0de1a20a9bd556daa8_1280.jpg","imageWidth":2848,"imageHeight":4288,"imageSize":2236073,"views":707485,"downloads":534456,"collections":778,"likes":670,"comments":111,"user_id":168090,"user":"goranmx","userImageURL":""},{"id":2369664,"pageURL":"https://pixabay.com/photos/art-multicoloured-to-dye-abstract-2369664/","type":"photo","tags":"art, multicoloured, to dye","previewURL":"https://cdn.pixabay.com/photo/2017/06/03/20/12/art-2369664_150.jpg","previewWidth":99,"previewHeight":150,"webformatURL":"https://pixabay.com/get/g8b024d3907607c74863abb26d4279905f5af87cfb2028f7538776959ff43d8071949f2373d2ecaf3dd078db0c5f9928f2c3ac4428ad171fea5b21895024d383d_640.jpg","webformatWidth":424,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/gd09abfc758904a35bb11300c8d5a6de74a1c2eb0b9c9a58ea06ad97681a055309981afb834cc63e0066eb5d55e2747765199c3788421fc3eb78065ddee0e25b4_1280.jpg","imageWidth":3264,"imageHeight":4928,"imageSize":4032363,"views":625658,"downloads":558069,"collections":879,"likes":607,"comments":75,"user_id":4894494,"user":"eluela31","userImageURL":"https://cdn.pixabay.com/user/2017/04/24/19-55-29-652_250x250.jpg"},{"id":1659054,"pageURL":"https://pixabay.com/photos/grass-lawn-garden-park-ground-1659054/","type":"photo","tags":"grass, lawn, garden","previewURL":"https://cdn.pixabay.com/photo/2016/09/10/12/40/grass-1659054_150.jpg","previewWidth":81,"previewHeight":150,"webformatURL":"https://pixabay.com/get/ga0fb4d99104d105e1daea4b60ad1f2dec689ab2f5a61046dc4b437b3879999442b2e87a35521b153bc1b88eb991d078a49eb7e878498e4d490074ed841464c49_640.jpg","webformatWidth":346,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/gc1fa30ac5d2593f62719a557bb879c278637ef068711b5abbac9cfaa5059d7d12c46e050ce6a45ec470f6f25633841de63b7778bb09c9d08f132c8046dc1f49f_1280.jpg","imageWidth":2659,"imageHeight":4911,"imageSize":8444898,"views":536868,"downloads":446490,"collections":816,"likes":642,"comments":93,"user_id":1594796,"user":"jeonsango","userImageURL":"https://cdn.pixabay.com/user/2016/04/22/14-26-25-744_250x250.jpg"},{"id":410311,"pageURL":"https://pixabay.com/photos/iphone-hand-screen-smartphone-apps-410311/","type":"photo","tags":"iphone, hand, screen","previewURL":"https://cdn.pixabay.com/photo/2014/08/05/10/27/iphone-410311_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g46941f768d16f3f107847b082ec70303e29e744270ed7746ea09d8107be809e3f390bd1da0883e136198472ef48580ee_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g28ab7360cb72f648b9bb473b1031e5518d18ee158990be94dfd3f1d2dc4ba4d3d01885d9f7acabd45b6f37664675e5c8571711ead9eed4be209076a4bd887af9_1280.jpg","imageWidth":1920,"imageHeight":1280,"imageSize":416413,"views":582376,"downloads":299078,"collections":648,"likes":628,"comments":171,"user_id":264599,"user":"JESHOOTS-com","userImageURL":"https://cdn.pixabay.com/user/2014/06/08/15-27-10-248_250x250.jpg"},{"id":1052023,"pageURL":"https://pixabay.com/photos/glasses-book-phone-iphone-1052023/","type":"photo","tags":"glasses, book, phone","previewURL":"https://cdn.pixabay.com/photo/2015/11/19/21/14/glasses-1052023_150.jpg","previewWidth":150,"previewHeight":112,"webformatURL":"https://pixabay.com/get/g9a126bb5137e4327808691a7059c5b02eacf83564e38ad1261f5b6c0530430b49a6160287812b440a01403998214be1e8adf19e169fb23a86fecdb339781a074_640.jpg","webformatWidth":640,"webformatHeight":480,"largeImageURL":"https://pixabay.com/get/g4cb6a7177b144d9202218b6bd7b03717380371fec211d8837ca5950effd96182ae84091d2ccf54ec0140d4f88a3a982ade1397d6d77a3091b383443ed0a4347f_1280.jpg","imageWidth":4533,"imageHeight":3400,"imageSize":3219890,"views":307475,"downloads":189294,"collections":655,"likes":605,"comments":87,"user_id":1441456,"user":"DariuszSankowski","userImageURL":"https://cdn.pixabay.com/user/2015/12/21/10-54-58-771_250x250.jpg"},{"id":1850893,"pageURL":"https://pixabay.com/photos/morning-bedroom-bed-door-girl-1850893/","type":"photo","tags":"morning, bedroom, bed","previewURL":"https://cdn.pixabay.com/photo/2016/11/22/22/18/morning-1850893_150.jpg","previewWidth":100,"previewHeight":150,"webformatURL":"https://pixabay.com/get/g5a652ed53e192a53e82ee2044d9aea8b7cc5942691cd6ca24e4f539a720aba305a29a80ffda60ee1322ac97ff672a1b904a3d572502d320725af779f01811753_640.jpg","webformatWidth":426,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/gc9d5d1badfa2a1105280c22515de88939555de062c826d78479c41625855421b7f0c2e3e5d3fa842b13c03384fece7cbb466b76060a321a2108fe305e02fac0e_1280.jpg","imageWidth":3264,"imageHeight":4896,"imageSize":1383694,"views":217813,"downloads":144074,"collections":712,"likes":499,"comments":53,"user_id":2286921,"user":"Pexels","userImageURL":"https://cdn.pixabay.com/user/2016/03/26/22-06-36-459_250x250.jpg"},{"id":1807521,"pageURL":"https://pixabay.com/photos/hot-air-balloons-bagan-sunset-1807521/","type":"photo","tags":"hot air balloons, bagan, sunset","previewURL":"https://cdn.pixabay.com/photo/2016/11/08/05/18/hot-air-balloons-1807521_150.jpg","previewWidth":105,"previewHeight":150,"webformatURL":"https://pixabay.com/get/g9d469dbcf99b8e91560e908fd77449034d6c4e26a5bdbd3c6ad149745109a1890c9bf23adb50b9cb49a8d113977f9047ef128ac7011ec698cb41265fb0f2f490_640.jpg","webformatWidth":450,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/gd0ee023868d6cfcab5f9c5dec1307dd9dd631d5e8fc53e2434417a7e11415c2ee497280c5c2ff5b62ef872ad244b5198f0d6482b84bcb248e1d21e3de7094677_1280.jpg","imageWidth":2504,"imageHeight":3558,"imageSize":2054554,"views":500681,"downloads":305511,"collections":628,"likes":545,"comments":37,"user_id":3639875,"user":"sasint","userImageURL":"https://cdn.pixabay.com/user/2016/10/30/05-50-54-750_250x250.jpg"},{"id":3354062,"pageURL":"https://pixabay.com/photos/water-waterfall-outdoors-adult-3354062/","type":"photo","tags":"water, waterfall, outdoors","previewURL":"https://cdn.pixabay.com/photo/2018/04/27/08/55/water-3354062_150.jpg","previewWidth":120,"previewHeight":150,"webformatURL":"https://pixabay.com/get/g554f2035d752d5a525964ff278d44fd1fed951f0903f80cb2e4453afd5d2a9bdb21e169f9ffa0c695630ea5d0d63757b40733aa93a3b9fef0ec4858817335a58_640.jpg","webformatWidth":512,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/g846969dc48433a29b2aecc3d544beb5d9a94cc9941c58988e544348dbd0326e457e7ef5a48dff7f0f871e4c2ee06dcc2553e052a377b67a5402b671e660fe5dd_1280.jpg","imageWidth":3712,"imageHeight":4640,"imageSize":4537291,"views":447671,"downloads":358791,"collections":593,"likes":524,"comments":52,"user_id":8807492,"user":"ollivves","userImageURL":"https://cdn.pixabay.com/user/2018/04/26/09-00-53-532_250x250.jpg"},{"id":1887231,"pageURL":"https://pixabay.com/photos/star-anise-spices-spoon-anise-1887231/","type":"photo","tags":"star anise, spices, spoon","previewURL":"https://cdn.pixabay.com/photo/2016/12/06/18/26/star-anise-1887231_150.jpg","previewWidth":123,"previewHeight":150,"webformatURL":"https://pixabay.com/get/g51a88f7ac07c1aa8dd2cdcc3cfdd4d6fa3efc6a81fd31df6b733a4ff1a6d3fe4fc979a4c5164697e520fc7f4977751291b9dc9333edd2343d41e475f25529f61_640.jpg","webformatWidth":525,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/gba033c9a79f1830423aa094bba87ada11062ae5da0c6a1f46718dbd02ad6c74e31326df7e762098971e4bb9d3412e8496470cf617eda71d61959edc006fa1d28_1280.jpg","imageWidth":2443,"imageHeight":2979,"imageSize":2971528,"views":223721,"downloads":177819,"collections":580,"likes":534,"comments":58,"user_id":3938704,"user":"Daria-Yakovleva","userImageURL":"https://cdn.pixabay.com/user/2016/12/06/15-05-11-524_250x250.jpg"}]}
""";
